<pre>
    <script>
    class XRegExp {
        constructor(source, flag, root = "root") {
            this.table = new Map();
            this.regexp = new RegExp(
                this.compileRegExp(source, root, 0).source,
                flag
            );
            console.log(this.regexp);
            console.log(this.table);
        }
        // start is used to record the order   
        compileRegExp(source, name, start) {
            // only compile string
            if (source[name] instanceof RegExp) {
                return {
                    source: source[name].source,
                    length: 0,
                };
            }
            let length = 0;
            //match type
            let regexp = source[name].replace(/\<([^>]+)\>/g, (str, $1) => {
                this.table.set(start + length, $1);

                ++length;

                let r = this.compileRegExp(source, $1, start + length);

                length += r.length;
                // transform to regular expression
                return "(" + r.source + ")";
            });
            return {
                source: regexp,
                length: length,
            };
        }
        // 
        exec(string) {
            let r = this.regexp.exec(string);
            for (let i = 1; i < r.length; i++) {
                if (r[i] !== void 0) {
                    // get type
                    r[this.table.get(i - 1)] = r[i];
                }
            }
            return r;
        }
        get lastIndex() {
            return this.regexp.lastIndex;
        }
        set lastIndex(value) {
            return (this.regexp.lastIndex = value);
        }
    }
    function scan(str) {
        // to manage regular expression
        let regexp = new XRegExp(
        {
            InputElement: "<Whitespace>|<LineTerminator>|<Comments>|<Token>",
            Whitespace: / /,
            LineTerminator: /\n/,
            Comments: /\/\*(?:[^*]|\*[^\/])*\*\/|\/\/[^\n]*/,
            Token: "<Literal>|<Keywords>|<Identifier>|<Punctuator>",
            Literal:
            "<NumericLiteral>|<BooleanLiteral>|<StringLiteral>|<NullLiteral>",
            NumericLiteral: /(?:[1-9][0-9]*|0)(?:\.[0-9]*)?|\.[0-9]+/,
            BooleanLiteral: /true|false/,
            StringLiteral: /\"(?:[^"\n]|\\[\s\S])*\"|\'(?:[^'\n]|\\[\s\S])*\'/,
            NullLiteral: /null/,
            Keywords: /if|else|for|function|let|var/,
            Identifier: /[a-zA-Z_$][a-zA-Z0-9_$]*/,
            Punctuator: /\;|\.|\+|\,|\:|\{|\}|\(|\)|\=|\<|\>|\=\=|\=\>|\*|\[|\]/,
        },
        "g",
        "InputElement"
        );

        while (regexp.lastIndex < str.length) {
            let r = regexp.exec(str);

            console.log(JSON.stringify(r[0]));

            //   document.write(r[0]);

            if (!r[0].length) break;
        }
    }
    scan(`
            for(let i=0;i<3;i++){
                for(let j=0;j<3;j++){
                    let cell = document.createElement("div");
                    cell.classList.add("cell");
                    cell.innerText = pattern[i*3+j] == 2 ? "❌" :
                        pattern[i*3+j] == 1 ? "🈲️" : "";
                    cell.addEventListener('click',()=>{
                        userMove(j,1)
                    });
                    board.appendChild(cell);
                }
                board.appendChild(document.createElement("br"))
            }
        `);
    </script>
</pre>
